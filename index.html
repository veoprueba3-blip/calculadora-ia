<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÇ Calculadora Profesional express de Pasteler√≠a üßÅ</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #FFF5F5; color: #5D4E60; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #FFB6C1; border-radius: 20px; padding: 40px; text-align: center; margin-bottom: 30px; color: #5D4E60; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        #recipeNameInput { width: 100%; padding: 12px; border: 2px solid #FFD4CC; border-radius: 10px; font-size: 1.1rem; text-align: center; font-family: 'Poppins', sans-serif; color: #5D4E60; }
        #recipeNameInput::placeholder { color: #D8838F; }
        .card { background: #FFFFFF; border-radius: 20px; padding: 30px; margin-bottom: 25px; box-shadow: 0 5px 20px rgba(255, 182, 193, 0.2); border: 2px solid #FFE4E1; }
        .card h2 { color: #D8838F; margin-bottom: 5px; font-size: 1.8rem; }
        .card .section-description { font-size: 0.95rem; color: #7a6c7b; margin-top: -15px; margin-bottom: 25px; text-align: center; }
        .history-section { display: grid; grid-template-columns: 1fr auto auto auto; gap: 15px; align-items: center; }
        .history-section select, .history-section button { padding: 10px 15px; font-size: 0.9rem; border: 2px solid #FFE4E1; border-radius: 8px; font-family: 'Poppins', sans-serif; }
        .history-section select { width: 100%; }
        .history-section button { cursor: pointer; font-weight: 600; transition: all 0.2s; }
        .info-toggle { background: linear-gradient(135deg, #98D8C8 0%, #7DCFBB 100%); color: #2C5F5F; padding: 12px 20px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px; transition: all 0.3s ease; font-weight: 600; }
        .info-toggle:hover { transform: translateY(-2px); }
        .info-toggle.active { background: linear-gradient(135deg, #FFB6C1 0%, #FFA0B4 100%); color: #5D4E60; }
        .info-toggle-red { background: linear-gradient(135deg, #FF6B6B 0%, #FF5252 100%); color: #FFFFFF; padding: 12px 20px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px; transition: all 0.3s ease; font-weight: 600; }
        .info-toggle-red:hover { transform: translateY(-2px); }
        .info-toggle-red.active { background: linear-gradient(135deg, #FF8A80 0%, #FF6B6B 100%); }
        .toggle-icon { transition: transform 0.3s ease; font-size: 1.2rem; }
        .info-toggle.active .toggle-icon, .info-toggle-red.active .toggle-icon { transform: rotate(180deg); }
        .info-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease, opacity 0.3s ease; opacity: 0; }
        .info-content.show { max-height: 2000px; opacity: 1; }
        .info-box { background: #F0FFF0; padding: 20px; border-radius: 15px; margin-bottom: 25px; border-left: 5px solid #98D8C8; }
        .info-box h3 { color: #6B8E7F; margin-bottom: 10px; }
        .info-box p { color: #5A7969; margin-bottom: 8px; }
        .info-box strong { color: #4A6959; }
        .info-box-red { background: #FFF5F5; padding: 20px; border-radius: 15px; margin-bottom: 25px; border-left: 5px solid #FF6B6B; }
        .info-box-red h3 { color: #C62828; margin-bottom: 10px; }
        .info-box-red p { color: #424242; margin-bottom: 8px; }
        .product-type-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .product-card { background: #FFE4E1; padding: 20px; border-radius: 15px; cursor: pointer; text-align: center; color: #5D4E60; border: 2px solid #FFD4CC; transition: all 0.3s; }
        .product-card:hover { transform: translateY(-3px); }
        .product-card.active { background: #FFB6C1; border-color: #FF9FAC; box-shadow: 0 4px 15px rgba(255, 182, 193, 0.5); }
        .product-card h3 { font-size: 1.2rem; }
        .product-card p { font-size: 2rem; margin-bottom: 5px; }
        .portions-section { background: #FFF0E6; padding: 25px; border-radius: 15px; margin-top: 20px; }
        .portions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .portion-item { background: white; padding: 20px; border-radius: 12px; }
        .portion-item label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; }
        .portion-item input { width: 100%; padding: 10px; border: 2px solid #FFE4E1; border-radius: 8px; font-size: 1rem; }
        .ingredients-table-wrapper { width: 100%; overflow-x: auto; }
        .ingredients-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; min-width: 750px; }
        .ingredients-table th { background: #F5D5CE; color: #5D4E60; padding: 12px; text-align: left; font-weight: 600; }
        .ingredients-table td { padding: 10px; border-bottom: 1px solid #FFE4E1; }
        .ingredients-table input, .ingredients-table select { width: 100%; padding: 8px; border: 2px solid #FFE4E1; border-radius: 8px; font-size: 1rem; }
        .cost-display { background: #98D8C8; color: #2C5F5F; padding: 8px 12px; border-radius: 8px; font-weight: 600; text-align: center; min-width: 100px; display: inline-block; }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.5px; font-size: 1rem; }
        .btn-primary { background: #FFB6C1; color: #5D4E60; }
        .btn-primary:hover { background: #FFA0B4; transform: translateY(-2px); }
        .btn-success { background: #98D8C8; color: #2C5F5F; }
        .btn-success:hover { background: #7DCFBB; transform: translateY(-2px); }
        .btn-warning { background: #FFD93D; color: #5D4E60; }
        .btn-warning:hover { background: #FFC107; transform: translateY(-2px); }
        .btn-danger { background: #FF9999; color: white; width: 35px; height: 35px; border-radius: 50%; padding: 0; font-size: 1.2rem; }
        .btn-danger:hover { background: #FF7777; transform: rotate(90deg); }
        .additional-costs { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .cost-item { background: #FFF0F5; padding: 20px; border-radius: 12px; }
        .cost-item label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; }
        .cost-item input { width: 100%; padding: 10px; border: 2px solid #FFE4E1; border-radius: 8px; font-size: 1rem; }
        .cost-item input[readonly] { background: #f0f0f0 !important; cursor: not-allowed; color: #666; }
        .cost-item .help-text { font-size: 0.85rem; color: #666; margin-top: 5px; font-style: italic; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 25px 0; }
        .summary-item { background: #E6F7FF; padding: 20px; border-radius: 15px; text-align: center; }
        .summary-item h4 { color: #5D7A8C; font-size: 1rem; margin-bottom: 10px; }
        .summary-item .amount { font-size: 1.5rem; font-weight: 700; color: #2C5F5F; }
        .mode-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .mode-card { background: #FFFFFF; border: 3px solid #E0E0E0; border-radius: 20px; padding: 25px; cursor: pointer; transition: all 0.3s ease; position: relative; text-align: center; }
        .mode-card:hover { transform: translateY(-3px); }
        .mode-card.active { border-color: #4A90E2; background: linear-gradient(135deg, #F8FBFF 0%, #E8F4FD 100%); }
        .mode-card.active.professional { border-color: #7B68EE; background: linear-gradient(135deg, #F8F7FF 0%, #F0EFFF 100%); }
        .mode-card::before { content: ''; position: absolute; top: 15px; right: 15px; width: 20px; height: 20px; border: 2px solid #E0E0E0; border-radius: 50%; transition: all 0.3s ease; }
        .mode-card.active::before { background: #4A90E2; border-color: #4A90E2; }
        .mode-card.active.professional::before { background: #7B68EE; border-color: #7B68EE; }
        .mode-card.active::after { content: '‚úì'; position: absolute; top: 18px; right: 18px; color: white; font-weight: bold; font-size: 0.8rem; }
        .mode-icon { font-size: 3rem; margin-bottom: 15px; }
        .mode-title { font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; }
        .mode-subtitle { font-size: 0.9rem; color: #666; margin-bottom: 15px; }
        .mode-explanation { background: #F0F8FF; padding: 15px; border-radius: 10px; font-size: 0.85rem; color: #2C5F5F; margin-bottom: 10px; }
        .calculator-section { display: none; background: #F8F9FA; padding: 30px; border-radius: 20px; margin-top: 20px; }
        .calculator-section.show { display: block; }
        .percentage-guide-section { background: #FFF9F9; padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #FFE4E1; }
        .percentage-guide-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .percentage-card { background: white; padding: 20px; border-radius: 15px; text-align: center; border: 3px solid #E0E0E0; transition: all 0.3s ease; }
        .percentage-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .percentage-card.basic { border-color: #4A90E2; background: linear-gradient(135deg, #F8FBFF 0%, #E8F4FD 100%); }
        .percentage-card.standard { border-color: #6BCF7F; background: linear-gradient(135deg, #F0FFF4 0%, #E8F5E8 100%); }
        .percentage-card.premium { border-color: #FFB347; background: linear-gradient(135deg, #FFF9E6 0%, #FFF0D4 100%); }
        .percentage-card.luxury { border-color: #FF6B6B; background: linear-gradient(135deg, #FFE6E6 0%, #FFD4D4 100%); }
        .percentage-value { font-size: 2.5rem; font-weight: bold; margin-bottom: 10px; }
        .percentage-card.basic .percentage-value { color: #4A90E2; }
        .percentage-card.standard .percentage-value { color: #6BCF7F; }
        .percentage-card.premium .percentage-value { color: #FFB347; }
        .percentage-card.luxury .percentage-value { color: #FF6B6B; }
        .percentage-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; color: #333; }
        .percentage-description { font-size: 0.9rem; color: #666; line-height: 1.4; }
        .slider-container { background: #FFE4E1; padding: 25px; border-radius: 15px; margin-top: 20px; }
        .slider { width: 100%; height: 10px; border-radius: 10px; background: white; outline: none; -webkit-appearance: none; margin: 20px 0; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 25px; height: 25px; border-radius: 50%; background: #FFB6C1; cursor: pointer; }
        .profit-display { text-align: center; font-size: 1.8rem; font-weight: 700; color: #D8838F; }
        .unit-results { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }
        .unit-result-card { background: #FFF5F5; padding: 25px; border-radius: 15px; text-align: center; border: 2px solid #FFE4E1; }
        .unit-result-card h4 { color: #D8838F; font-size: 1.2rem; margin-bottom: 15px; }
        .unit-result-card .price { font-size: 2rem; font-weight: 700; color: #98D8C8; margin: 10px 0; }
        .result-card { background: #FFDAB9; padding: 40px; border-radius: 20px; text-align: center; margin: 30px 0; border: 3px solid #FFB6C1; }
        .final-price { font-size: 3rem; font-weight: 700; color: #5D4E60; margin: 20px 0; }
        .action-buttons { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .chat-window { height: 350px; border: 2px solid #FFE4E1; border-radius: 15px; padding: 15px; overflow-y: auto; margin-bottom: 15px; display: flex; flex-direction: column; gap: 12px; }
        .chat-message { padding: 10px 15px; border-radius: 20px; max-width: 85%; line-height: 1.4; white-space: pre-wrap; }
        .ai-message { background: #E6F7FF; color: #5D7A8C; border-bottom-left-radius: 5px; align-self: flex-start; }
        .user-message { background: #FFB6C1; color: #5D4E60; border-bottom-right-radius: 5px; align-self: flex-end; }
        .chat-input-area { display: flex; gap: 10px; }
        .chat-input-area input { flex-grow: 1; padding: 12px; border: 2px solid #FFE4E1; border-radius: 10px; font-size: 1rem; }
        .chat-input-area button { padding: 12px 20px; border: none; background: #98D8C8; color: #2C5F5F; font-weight: 600; border-radius: 10px; cursor: pointer; transition: background 0.2s; }
        .chat-input-area button:hover { background: #7DCFBB; }
        .typing-indicator { display: flex; align-items: center; padding: 10px 0; }
        .typing-indicator span { height: 8px; width: 8px; background-color: #98D8C8; border-radius: 50%; display: inline-block; margin: 0 2px; animation: bounce 1.2s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-6px); } }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header { padding: 25px 15px; }
            .header h1 { font-size: 1.8rem; }
            .card { padding: 20px; }
            .mode-selector, .history-section { grid-template-columns: 1fr; }
            .action-buttons .btn { width: 100%; margin-bottom: 10px; font-size: 0.9rem; padding: 15px; }
        }
        
        @media (max-width: 480px) {
            .header { padding: 20px 15px; }
            .header h1 { font-size: 1.6rem; }
            .card { padding: 15px; }
            .card h2 { font-size: 1.4rem; }
            .final-price { font-size: 2.2rem; }
            .percentage-guide-grid { grid-template-columns: 1fr; }
            .chat-window { height: 60vh; }
            .chat-message { max-width: 92%; font-size: 0.9rem; }
            .product-card { padding: 15px; }
            .product-card h3 { font-size: 1rem; }
            .product-card p { font-size: 1.5rem; }
            .btn { font-size: 0.9rem; padding: 14px; }
            #recipeNameInput { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÇ Calculadora Profesional express de Pasteler√≠a üßÅ</h1>
            <p>Descubre el precio justo que valora tu trabajo y te deja ganancias reales en minutos</p>
        </div>

        <div class="card">
            <h2>üìù Dale un Nombre a tu C√°lculo</h2>
            <p class="section-description" style="margin-top: 0;">Este nombre se usar√° para guardar tu receta y en tus cotizaciones.</p>
            <input type="text" id="recipeNameInput" placeholder="Ej: Torta de Chocolate para Boda">
        </div>

        <div class="card">
            <h2>üç∞ 1. Elige tu Producto</h2>
            <div class="product-type-selector"><div class="product-card active" onclick="selectProduct('pastel')" id="pastel-card"><p>üéÇ</p><h3>Pastel</h3></div><div class="product-card" onclick="selectProduct('cupcakes')" id="cupcakes-card"><p>üßÅ</p><h3>Cupcakes</h3></div><div class="product-card" onclick="selectProduct('galletas')" id="galletas-card"><p>üç™</p><h3>Galletas</h3></div><div class="product-card" onclick="selectProduct('donas')" id="donas-card"><p>üç©</p><h3>Donas</h3></div><div class="product-card" onclick="selectProduct('postres')" id="postres-card"><p>üçÆ</p><h3>Postres</h3></div><div class="product-card" onclick="selectProduct('otros')" id="otros-card"><p>üì¶</p><h3>Otros</h3></div></div>
            <div class="portions-section"><div style="display: flex; align-items: baseline; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;"><h3 style="color: #444; margin: 0;">‚öôÔ∏è Configuraci√≥n del Producto</h3><span style="font-size: 0.85rem; color: #C62828; font-weight: bold;">(NOTA: si vas a vender pasteles dejas la configuraci√≥n tal cual como est√°, si lo vas a hacer por porciones u otro producto ah√≠ s√≠ ingresas las porciones)</span></div><div class="portions-grid"><div class="portion-item"><label for="totalQuantity">üìä Cantidad Total a Producir:</label><input type="number" id="totalQuantity" value="1" min="1" oninput="updateCalculations()"></div><div class="portion-item"><label for="unitName">üìù Nombre de la Unidad:</label><input type="text" id="unitName" value="porciones" readonly style="background-color: #f0f0f0; cursor: not-allowed;"></div></div></div>
        </div>
        <div class="card">
            <h2>ü•Ñ 2. Ingredientes</h2>
            <div class="info-toggle" onclick="toggleInfo('ingredients')"><span>üí° TOCA AQU√ç PARA VER C√ìMO FUNCIONA ESTA SECCI√ìN</span><span class="toggle-icon">‚ñº</span></div><div id="ingredients-info" class="info-content"><div class="info-box"><h3>üí° ¬øC√≥mo funciona esta secci√≥n?</h3><p><strong>Aqu√≠ registras todos los ingredientes de tu receta (OJO Solo los ingredientes).</strong></p><p>La calculadora toma el precio del paquete completo (bolsa de arina, azucar, cubeta de huevos) mejor dicho la cantidad total que compraste, y calcula autom√°ticamente cu√°nto gastaste en la porci√≥n exacta que usaste</p><p>Usa el + para agregar ingredientes o usa la X del c√≠rculo para eliminarlo</p><p>‚úÖ Puedes usar <strong>libras (lb)</strong> adem√°s de gramos, ml, unidades, kg y litros.</p><p><strong>üéÇ Ejemplo:</strong><br>1 Paquete de harina de 10 lb te valieron = $45,000<br>de esas 10lbs usaste = 2 lb<br><strong>Costo real (a como te salen las 2 libras) = $9,000</strong></p></div></div><div class="ingredients-table-wrapper"><table class="ingredients-table"><thead><tr><th>Ingrediente</th><th>Cantidad Usada</th><th>Unidad</th><th>Cantidad Total del Paquete</th><th>Precio del Paquete Completo ($)</th><th>Costo</th><th>√ó</th></tr></thead><tbody id="ingredientsBody"><tr><td><input type="text" value="" placeholder="Ej: Harina de trigo" class="ingredient-name"></td><td><input type="number" value="0" class="amount-used" step="0.01" oninput="updateCalculations()"></td><td><select class="unit" onchange="updateCalculations()"><option value="g">gramos</option><option value="ml">ml</option><option value="units">unidades</option><option value="kg">kg</option><option value="l">litros</option><option value="lb" selected>libras</option></select></td><td><input type="number" value="0" class="package-amount" step="0.01" oninput="updateCalculations()"></td><td><input type="number" value="0" class="package-price" step="100" oninput="updateCalculations()"></td><td><span class="cost-display">$0</span></td><td><button class="btn btn-danger" onclick="deleteRow(this)">√ó</button></td></tr></tbody></table></div><button class="btn btn-primary" onclick="addIngredient()" style="width: 100%;">‚ûï AGREGAR INGREDIENTE</button>
        </div>
        <div class="card">
            <h2>üí∞ 3. Costos Adicionales</h2>
            <div class="info-toggle" onclick="toggleInfo('costs')"><span>üìñ TOCA AQU√ç PARA VER C√ìMO CALCULAR CADA COSTO</span><span class="toggle-icon">‚ñº</span></div><div id="costs-info" class="info-content"><div class="info-box"><h3>‚öôÔ∏è ¬øPara qu√© sirve esta secci√≥n?</h3><p><strong>Incluye todos esos gastos "invisibles" que siempre olvidas.</strong></p><p>Tu tiempo vale oro. El gas, la luz, el empaque bonito... todo debe estar en el precio.</p><h3 style="margin-top: 20px;">üìñ C√≥mo usar cada campo:</h3><p><strong>‚è∞ Horas de trabajo:</strong> Suma TODO el tiempo (preparaci√≥n + horneado + decoraci√≥n + limpieza)</p><p><strong>üíµ Valor por hora:</strong> En Colombia, una repostera cobra entre $8,000-$15,000/hora. Sugerimos $10,000/hora como est√°ndar profesional</p><p><strong>üîß Desgaste de Utensilios:</strong> Se calcula autom√°tico como 2% de los ingredientes (moldes, batidoras, hornos se desgastan con cada uso)</p><p><strong>üì¶ Empaque:</strong> Caja + mo√±o + etiqueta + bolsa + todo lo que uses para entregar bonito</p><p><strong>üöö Env√≠o:</strong> Si t√∫ lo entregas, calcula gasolina. Si usas mensajer√≠a, pon el costo</p><h3 style="margin-top: 20px;">‚ö° SERVICIOS (Luz, Gas, Agua) - C√≥mo calcularlo:</h3><p><strong>Ejemplo vamos a Calcular por: uso del horno:</strong></p><p>‚Ä¢ Horno el√©ctrico 1 hora = $2,000-3,000 de luz aprox</p><p>‚Ä¢ Horno a gas 1 hora = $1,500-2,500 de gas aprox</p><p>‚Ä¢ Si horneas 2 horas = multiplica x2</p><p>‚Ä¢ Si horneas 3+ horas = multiplica x3</p><p>‚Ä¢Revisar en tu horno cu√°ntos Watts (W) consume, pasarlo a kW dividiendo entre 1000, Multiplicar por lo que te cobra tu empresa de energ√≠a en tu recibo.</p><p><strong>üí° NOTA:</strong> estos valores deben ser reales de acuerdo a tu recibo de la luz y solo si crees o te parece bien a√±adirlos, te aconsejamos a√±adirlos pero teniendo a la mano los recibos</p></div></div><div class="additional-costs"><div class="cost-item"><label>‚è∞ Horas de trabajo:</label><input type="number" id="laborHours" value="0" step="0.5" oninput="updateCalculations()"><div class="help-text">Incluye preparaci√≥n, horneado y decoraci√≥n</div></div><div class="cost-item"><label>üíµ Valor por hora ($):</label><input type="number" id="hourlyRate" value="0" step="1000" oninput="updateCalculations()"><div class="help-text">Promedio en Colombia $7.000 como sugerencia</div></div><div class="cost-item"><label>üîß Desgaste de Utensilios:</label><input type="number" id="toolWear" value="0" readonly><div class="help-text">Se calcula autom√°tico: 2% </div></div><div class="cost-item"><label>‚ö° Servicios (Luz, Gas, Agua):</label><input type="number" id="utilities" value="0" step="500" oninput="updateCalculations()"><div class="help-text">Ver cuadro informativo arriba</div></div><div class="cost-item"><label>üì¶ Empaque:</label><input type="number" id="packaging" value="0" step="500" oninput="updateCalculations()"><div class="help-text">Caja, mo√±o, etiqueta, etc.</div></div><div class="cost-item"><label>üöö Env√≠o/Transporte:</label><input type="number" id="shipping" value="0" step="1000" oninput="updateCalculations()"><div class="help-text">Si aplica para tu cliente</div></div></div>
        </div>
        <div class="card">
            <h2>üìä 4. Resumen de Costos</h2>
            <div class="summary-grid"><div class="summary-item"><h4>ü•Ñ Ingredientes</h4><div class="amount" id="ingredientsCost">$0</div></div><div class="summary-item"><h4>üë©‚Äçüç≥ Mano de Obra</h4><div class="amount" id="laborCost">$0</div></div><div class="summary-item"><h4>üîß Desgaste Utensilios</h4><div class="amount" id="toolWearCost">$0</div></div><div class="summary-item"><h4>üì¶ Otros Costos</h4><div class="amount" id="extraCosts">$0</div></div><div class="summary-item"><h4>üí∞ Costo Total</h4><div class="amount" id="totalCost">$0</div></div></div>
        </div>
        <div class="card">
            <h2>üéØ 5. Elige tu Ganancia</h2>
            <div class="info-toggle-red" onclick="toggleInfo('modes')"><span>üí° TOCA AQU√ç PARA ENTENDER CU√ÅL MODO ELEGIR</span><span class="toggle-icon">‚ñº</span></div><div id="modes-info" class="info-content"><div class="info-box-red"><h3>ü§î ¬øCu√°l modo debo elegir?</h3><p><strong>Muy f√°cil: Todo depende de c√≥mo quieres pensar sobre tu ganancia.</strong></p><div style="background: #E8F4FD; padding: 20px; border-radius: 15px; margin: 20px 0; border-left: 5px solid #4A90E2;"><h4 style="color: #4A90E2; margin-bottom: 15px;">üåü MODO F√ÅCIL - Para cuando apenas empiezas</h4><p><strong>Piensa as√≠:</strong> "Mis costos son $10,000. Quiero ganar $5,000 encima. Total = $15,000"</p><p><strong>Ejemplo real:</strong></p><p>‚Ä¢ Tu pastel te cost√≥ $20,000 (ingredientes + tiempo + todo)</p><p>‚Ä¢ Quieres ganar 60% m√°s de lo que gastaste</p><p>‚Ä¢ <strong>Precio final = $32,000</strong> (tu ganancia = $12,000)</p><p style="color: #4A90E2;"><strong>üí° Perfecto para:</strong> Principiantes, ventas a amigos/familia, productos b√°sicos</p></div><div style="background: #F0EFFF; padding: 20px; border-radius: 15px; margin: 20px 0; border-left: 5px solid #7B68EE;"><h4 style="color: #7B68EE; margin-bottom: 15px;">üöÄ MODO PROFESIONAL - Para cuando ya tienes experiencia</h4><p><strong>Piensa as√≠:</strong> "De cada $100 que cobre, quiero que $50 sean ganancia pura"</p><p><strong>Ejemplo real:</strong></p><p>‚Ä¢ Tu pastel te cost√≥ $20,000 (mismo costo)</p><p>‚Ä¢ Quieres que el 50% del precio final sea ganancia</p><p>‚Ä¢ <strong>Precio final = $40,000</strong> (tu ganancia = $20,000)</p><p style="color: #7B68EE;"><strong>üí° Perfecto para:</strong> Negocios establecidos, clientes corporativos, productos premium</p></div><div style="background: #FFF9E6; padding: 20px; border-radius: 15px; margin: 20px 0; border: 2px solid #FFD700;"><h4 style="color: #B8860B; margin-bottom: 15px;">‚ö° RESUMEN S√öPER F√ÅCIL:</h4><p><strong>‚Ä¢ Modo F√°cil:</strong> "Quiero ganar X% m√°s de lo que gast√©"</p><p><strong>‚Ä¢ Modo Profesional:</strong> "Quiero que X% de lo que cobre sea ganancia pura"</p><br><p><strong>üéØ Consejo:</strong> Si apenas empiezas, usa Modo F√°cil. Si ya vendes bien y quieres ser m√°s profesional, usa Modo Profesional.</p></div></div></div><div class="mode-selector"><div class="mode-card" id="easy-mode" onclick="selectMode('easy')"><div class="mode-icon">üåü</div><div class="mode-title" style="color: #4A90E2;">Modo F√°cil</div><div class="mode-subtitle">Recomendado para principiantes</div><div class="mode-explanation"><strong>Tus costos + la ganancia que quieres = el precio de venta</strong></div></div><div class="mode-card" id="professional-mode" onclick="selectMode('professional')"><div class="mode-icon">üöÄ</div><div class="mode-title" style="color: #7B68EE;">Modo Profesional</div><div class="mode-subtitle">Para negocios en crecimiento</div><div class="mode-explanation"><strong>C√°lculo empresarial para saber la ganancia real</strong></div></div></div><div id="calculator-section" class="calculator-section"><div class="percentage-guide-section"><div class="info-toggle" onclick="toggleInfo('percentage-guide')"><span>üéØ GU√çA: ¬øQU√â PORCENTAJE USAR SEG√öN TU SITUACI√ìN?</span><span class="toggle-icon">‚ñº</span></div><div id="percentage-guide-info" class="info-content"><div class="percentage-guide-grid"><div class="percentage-card basic"><div class="percentage-value">30-50%</div><div class="percentage-title">Productos B√°sicos</div><div class="percentage-description">Ideal para productos simples, clientes frecuentes o cuando est√°s empezando tu negocio</div></div><div class="percentage-card standard"><div class="percentage-value">50-80%</div><div class="percentage-title">Productos Est√°ndar</div><div class="percentage-description">Perfecto para productos personalizados y decoraciones de nivel intermedio</div></div><div class="percentage-card premium"><div class="percentage-value">80-100%</div><div class="percentage-title">Productos Premium</div><div class="percentage-description">Para dise√±os complejos, productos especializados o eventos importantes</div></div><div class="percentage-card luxury"><div class="percentage-value">100%+</div><div class="percentage-title">Productos de Lujo</div><div class="percentage-description">Para productos √∫nicos, pedidos urgentes o dise√±os muy exclusivos</div></div></div></div></div><div class="slider-container"><h3 id="calculator-title" style="color: #444; margin-bottom: 15px;">Ajusta tu Ganancia</h3><p id="calculator-explanation" style="color: #666; margin-bottom: 20px;"></p><input type="range" min="10" max="100" value="50" class="slider" id="profitSlider" oninput="updateSlider()"><div class="profit-display"><span id="profitPercentage">50</span><span id="profit-label">%</span></div></div></div>
        </div>
        <div class="result-card"><h2 style="color: #5D4E60;">üí∞ RESULTADOS FINALES</h2><div class="unit-results" id="unitResults"></div><div style="margin: 20px 0;"><h3 style="color: #5D4E60; font-size: 1.2rem; margin-bottom: 10px;">PRECIO DE VENTA TOTAL</h3><div class="final-price" id="finalPrice">$0</div></div><div style="margin: 20px 0;"><h3 style="color: #5D4E60; font-size: 1.2rem; margin-bottom: 10px;">GANANCIA NETA</h3><div class="final-price" id="profitAmount">$0</div></div></div>
        <div class="card">
            <h2>ü§ñ Asistente de Pasteler√≠a IA</h2>
            <p class="section-description">Tu experto en costos, rentabilidad y recetas, conectado a Gemini.</p>
            <div id="chatWindow" class="chat-window"></div>
            <div class="chat-input-area"><input type="text" id="userInput" placeholder="Ej: ¬øC√≥mo puedo hacer mi torta m√°s rentable?"><button id="sendBtn" class="btn">Enviar</button></div>
        </div>
        <div class="card">
            <h2>üìö Historial de Recetas</h2>
            <p class="section-description">Guarda y carga tus c√°lculos para no volver a escribirlos.</p>
            <div class="history-section"><select id="historialRecetas"></select><button id="cargarBtn" class="btn-success">üìÇ Cargar</button><button id="guardarBtn" class="btn-primary">üíæ Guardar</button><button id="eliminarBtn" class="btn-danger" style="text-transform: none;">üóëÔ∏è</button></div>
        </div>
        <div class="action-buttons"><button class="btn btn-primary" onclick="limpiarFormulario()">‚ûï Nueva Cotizaci√≥n</button><button class="btn btn-warning" onclick="abrirCotizacion()">üìÑ Ver y Descargar Cotizaci√≥n</button></div>
    </div>
    <script>
        // --- L√ìGICA DE LA CALCULADORA ---
        let currentProduct = 'pastel'; let currentMode = null; function toggleInfo(section) { const infoContent = document.getElementById(section + '-info'); const toggleBtn = infoContent.previousElementSibling; infoContent.classList.toggle('show'); toggleBtn.classList.toggle('active'); } function selectProduct(product) { document.querySelectorAll('.product-card').forEach(card => { card.classList.remove('active'); }); document.getElementById(product + '-card').classList.add('active'); currentProduct = product; let unitText = ''; switch (product) { case 'pastel': unitText = 'porciones'; break; case 'cupcakes': unitText = 'cupcakes'; break; case 'galletas': unitText = 'galletas'; break; case 'donas': unitText = 'donas'; break; case 'postres': unitText = 'postres'; break; case 'otros': unitText = 'unidades'; break; } document.getElementById('unitName').value = unitText; updateCalculations(); } function selectMode(mode) { currentMode = mode; document.querySelectorAll('.mode-card').forEach(card => { card.classList.remove('active', 'professional'); }); const selectedCard = document.getElementById(mode + '-mode'); selectedCard.classList.add('active'); if (mode === 'professional') { selectedCard.classList.add('professional'); } document.getElementById('calculator-section').classList.add('show'); updateModeTexts(); updateCalculations(); } function updateModeTexts() { const title = document.getElementById('calculator-title'); const explanation = document.getElementById('calculator-explanation'); const label = document.getElementById('profit-label'); if (currentMode === 'easy') { title.textContent = 'üåü Ajusta tu Ganancia (Modo F√°cil)'; explanation.textContent = 'Mueve el control para decidir cu√°nto quieres ganar encima de tus costos'; label.textContent = '% de ganancia'; } else if (currentMode === 'professional') { title.textContent = 'üöÄ Ajusta tu Ganancia (Modo Profesional)'; explanation.textContent = 'Este c√°lculo te ayuda a saber el porcentaje real de ganancia sobre el precio final'; label.textContent = '% empresarial'; } } function addIngredient() { const tbody = document.getElementById('ingredientsBody'); const newRow = document.createElement('tr'); newRow.innerHTML = `<td><input type="text" class="ingredient-name" placeholder="Nombre"></td><td><input type="number" value="0" class="amount-used" step="0.01" oninput="updateCalculations()"></td><td><select class="unit" onchange="updateCalculations()"><option value="g">gramos</option><option value="ml">ml</option><option value="units">unidades</option><option value="kg">kg</option><option value="l">litros</option><option value="lb">libras</option></select></td><td><input type="number" value="0" class="package-amount" step="0.01" oninput="updateCalculations()"></td><td><input type="number" value="0" class="package-price" step="100" oninput="updateCalculations()"></td><td><span class="cost-display">$0</span></td><td><button class="btn btn-danger" onclick="deleteRow(this)">√ó</button></td>`; tbody.appendChild(newRow); } function deleteRow(button) { button.closest('tr').remove(); updateCalculations(); } function updateSlider() { const value = document.getElementById('profitSlider').value; document.getElementById('profitPercentage').textContent = value; updateCalculations(); } function formatCurrency(amount) { return '$' + Math.round(amount).toLocaleString('es-CO'); } function updateCalculations() { let totalIngredientsCost = 0; document.querySelectorAll('#ingredientsBody tr').forEach(row => { const amountUsed = parseFloat(row.querySelector('.amount-used').value) || 0; const packagePrice = parseFloat(row.querySelector('.package-price').value) || 0; const packageAmount = parseFloat(row.querySelector('.package-amount').value) || 1; const cost = (packageAmount > 0) ? (amountUsed / packageAmount) * packagePrice : 0; totalIngredientsCost += cost; row.querySelector('.cost-display').textContent = formatCurrency(cost); }); const toolWearCost = totalIngredientsCost * 0.02; document.getElementById('toolWear').value = Math.round(toolWearCost); const laborCost = (parseFloat(document.getElementById('laborHours').value) || 0) * (parseFloat(document.getElementById('hourlyRate').value) || 0); const extraCosts = (parseFloat(document.getElementById('utilities').value) || 0) + (parseFloat(document.getElementById('packaging').value) || 0) + (parseFloat(document.getElementById('shipping').value) || 0); const totalCost = totalIngredientsCost + laborCost + toolWearCost + extraCosts; document.getElementById('ingredientsCost').textContent = formatCurrency(totalIngredientsCost); document.getElementById('laborCost').textContent = formatCurrency(laborCost); document.getElementById('toolWearCost').textContent = formatCurrency(toolWearCost); document.getElementById('extraCosts').textContent = formatCurrency(extraCosts); document.getElementById('totalCost').textContent = formatCurrency(totalCost); let finalPrice = 0; let profitAmount = 0; if (currentMode && totalCost > 0) { const sliderValue = parseFloat(document.getElementById('profitSlider').value) || 0; if (currentMode === 'easy') { finalPrice = totalCost * (1 + (sliderValue / 100)); } else if (currentMode === 'professional') { finalPrice = (sliderValue < 100) ? totalCost / (1 - (sliderValue / 100)) : totalCost * 1000; } } profitAmount = finalPrice - totalCost; document.getElementById('finalPrice').textContent = formatCurrency(finalPrice); document.getElementById('profitAmount').textContent = formatCurrency(profitAmount); const totalQuantity = parseFloat(document.getElementById('totalQuantity').value) || 1; const unitName = document.getElementById('unitName').value || 'unidades'; const costPerUnit = totalQuantity > 0 ? totalCost / totalQuantity : 0; const pricePerUnit = totalQuantity > 0 ? finalPrice / totalQuantity : 0; const profitPerUnit = totalQuantity > 0 ? profitAmount / totalQuantity : 0; let displayPercentage = ''; let displayLabel = ''; if (currentMode === 'easy') { const profitOverCost = totalCost > 0 ? ((profitAmount / totalCost) * 100) : 0; displayPercentage = profitOverCost.toFixed(0) + '%'; displayLabel = '% Ganancia sobre Costo'; } else if (currentMode === 'professional') { const marginOnSales = finalPrice > 0 ? ((profitAmount / finalPrice) * 100) : 0; displayPercentage = marginOnSales.toFixed(1) + '%'; displayLabel = 'Margen sobre Ventas'; } else { displayPercentage = '0%'; displayLabel = 'Selecciona un modo'; } document.getElementById('unitResults').innerHTML = `<div class="unit-result-card"><h4>Costo por ${unitName}</h4><div class="price">${formatCurrency(costPerUnit)}</div></div><div class="unit-result-card"><h4>Precio de Venta por ${unitName}</h4><div class="price">${formatCurrency(pricePerUnit)}</div></div><div class="unit-result-card"><h4>Ganancia por ${unitName}</h4><div class="price">${formatCurrency(profitPerUnit)}</div></div><div class="unit-result-card"><h4>${displayLabel}</h4><div class="price">${displayPercentage}</div></div>`; } function limpiarFormulario() { if (confirm("¬øEst√°s seguro de que quieres empezar una nueva cotizaci√≥n? Se perder√°n los datos actuales no guardados.")) { location.reload(); } }
        const historialSelect = document.getElementById('historialRecetas'); const cargarBtn = document.getElementById('cargarBtn'); const guardarBtn = document.getElementById('guardarBtn'); const eliminarBtn = document.getElementById('eliminarBtn'); function actualizarHistorialDropdown() { const recetas = JSON.parse(localStorage.getItem('pasteleria_recetas')) || []; historialSelect.innerHTML = ''; if (recetas.length === 0) { historialSelect.innerHTML = '<option disabled selected>No hay recetas guardadas</option>'; } else { recetas.forEach(receta => { const option = document.createElement('option'); option.value = receta.nombre; option.textContent = receta.nombre; historialSelect.appendChild(option); }); } }
        function guardarReceta() {
            let nombreReceta = document.getElementById('recipeNameInput').value.trim();
            if (!nombreReceta) {
                nombreReceta = prompt("Por favor, ingresa un nombre para guardar la receta (ej: Torta de Chocolate 1 Libra)");
            }
            if (!nombreReceta) return;

            const recetaData = { nombre: nombreReceta, productType: currentProduct, totalQuantity: document.getElementById('totalQuantity').value, unitName: document.getElementById('unitName').value, laborHours: document.getElementById('laborHours').value, hourlyRate: document.getElementById('hourlyRate').value, utilities: document.getElementById('utilities').value, packaging: document.getElementById('packaging').value, shipping: document.getElementById('shipping').value, ingredientes: Array.from(document.querySelectorAll('#ingredientsBody tr')).map(row => ({ nombre: row.querySelector('.ingredient-name').value, cantidadUsada: row.querySelector('.amount-used').value, unidad: row.querySelector('.unit').value, cantidadPaquete: row.querySelector('.package-amount').value, precioPaquete: row.querySelector('.package-price').value })), calculationMode: currentMode, profitPercentage: document.getElementById('profitSlider').value }; let recetas = JSON.parse(localStorage.getItem('pasteleria_recetas')) || []; const recetaExistenteIndex = recetas.findIndex(r => r.nombre === nombreReceta); if (recetaExistenteIndex > -1) { if (confirm(`Ya existe una receta llamada "${nombreReceta}". ¬øDeseas sobrescribirla?`)) { recetas[recetaExistenteIndex] = recetaData; } else { return; } } else { recetas.push(recetaData); } localStorage.setItem('pasteleria_recetas', JSON.stringify(recetas)); alert(`¬°Receta "${nombreReceta}" guardada exitosamente!`); actualizarHistorialDropdown();
        }
        function cargarReceta() {
            const nombreReceta = historialSelect.value;
            if (!nombreReceta || nombreReceta === "No hay recetas guardadas") { alert("Por favor, selecciona una receta v√°lida para cargar."); return; }; const recetas = JSON.parse(localStorage.getItem('pasteleria_recetas')) || []; const recetaACargar = recetas.find(r => r.nombre === nombreReceta); if (!recetaACargar) { alert("No se encontr√≥ la receta seleccionada."); return; }
            document.getElementById('recipeNameInput').value = recetaACargar.nombre;
            selectProduct(recetaACargar.productType); document.getElementById('totalQuantity').value = recetaACargar.totalQuantity; document.getElementById('unitName').value = recetaACargar.unitName; document.getElementById('laborHours').value = recetaACargar.laborHours; document.getElementById('hourlyRate').value = recetaACargar.hourlyRate; document.getElementById('utilities').value = recetaACargar.utilities; document.getElementById('packaging').value = recetaACargar.packaging; document.getElementById('shipping').value = recetaACargar.shipping; const tbody = document.getElementById('ingredientsBody'); tbody.innerHTML = ''; if (recetaACargar.ingredientes && recetaACargar.ingredientes.length > 0) { recetaACargar.ingredientes.forEach(ing => { const newRow = tbody.insertRow(); newRow.innerHTML = `<td><input type="text" class="ingredient-name" value="${ing.nombre || ''}"></td><td><input type="number" value="${ing.cantidadUsada}" class="amount-used" step="0.01" oninput="updateCalculations()"></td><td><select class="unit" onchange="updateCalculations()"><option value="g">gramos</option><option value="ml">ml</option><option value="units">unidades</option><option value="kg">kg</option><option value="l">litros</option><option value="lb">libras</option></select></td><td><input type="number" value="${ing.cantidadPaquete}" class="package-amount" step="0.01" oninput="updateCalculations()"></td><td><input type="number" value="${ing.precioPaquete}" class="package-price" step="100" oninput="updateCalculations()"></td><td><span class="cost-display">$0</span></td><td><button class="btn btn-danger" onclick="deleteRow(this)">√ó</button></td>`; newRow.querySelector('.unit').value = ing.unidad; }); } if (recetaACargar.calculationMode) { selectMode(recetaACargar.calculationMode); const savedPercentage = recetaACargar.profitPercentage || 50; document.getElementById('profitSlider').value = savedPercentage; updateSlider(); } else { currentMode = null; document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('active', 'professional')); document.getElementById('calculator-section').classList.remove('show'); } updateCalculations(); alert(`Receta "${nombreReceta}" cargada.`);
        }
        function eliminarReceta() { const nombreReceta = historialSelect.value; if (!nombreReceta || nombreReceta === "No hay recetas guardadas") { alert("Por favor, selecciona una receta para eliminar."); return; }; if (confirm(`¬øEst√°s seguro de que quieres eliminar la receta "${nombreReceta}"? Esta acci√≥n no se puede deshacer.`)) { let recetas = JSON.parse(localStorage.getItem('pasteleria_recetas')) || []; recetas = recetas.filter(r => r.nombre !== nombreReceta); localStorage.setItem('pasteleria_recetas', JSON.stringify(recetas)); actualizarHistorialDropdown(); alert(`Receta "${nombreReceta}" eliminada.`); } } guardarBtn.addEventListener('click', guardarReceta); cargarBtn.addEventListener('click', cargarReceta); eliminarBtn.addEventListener('click', eliminarReceta);
            
        function abrirCotizacion() {
            const recipeName = document.getElementById('recipeNameInput').value.trim() || `Cotizaci√≥n de ${currentProduct}`;
            const productType = currentProduct.charAt(0).toUpperCase() + currentProduct.slice(1);
            const unitName = document.getElementById('unitName').value;
            const totalQuantity = document.getElementById('totalQuantity').value;
            const fecha = new Date().toLocaleDateString('es-CO', { year: 'numeric', month: 'long', day: 'numeric' });
            const validez = new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toLocaleDateString('es-CO', { year: 'numeric', month: 'long', day: 'numeric' });
            const ingredientes = Array.from(document.querySelectorAll('#ingredientsBody tr')).map(row => ({ nombre: row.querySelector('.ingredient-name').value || 'N/A', costo: row.querySelector('.cost-display').textContent }));
            const costos = { ingredientes: document.getElementById('ingredientsCost').textContent, manoObra: document.getElementById('laborCost').textContent, desgaste: document.getElementById('toolWearCost').textContent, extras: document.getElementById('extraCosts').textContent, total: document.getElementById('totalCost').textContent };
            const resultados = { porcentaje: document.getElementById('profitPercentage').textContent, modo: currentMode === 'easy' ? 'Modo F√°cil (Ganancia sobre costo)' : 'Modo Profesional (Margen de venta)', precioFinal: document.getElementById('finalPrice').textContent, ganancia: document.getElementById('profitAmount').textContent };
            
            const htmlCotizacion = `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <title>${recipeName}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script>
                    <style>
                        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 5px #f0b90b; } 50% { transform: scale(1.03); box-shadow: 0 0 20px #f0b90b; } 100% { transform: scale(1); box-shadow: 0 0 5px #f0b90b; } }
                        body { font-family: 'Poppins', sans-serif; color: #333; margin: 0; padding: 0; background-color: #f9f9f9; }
                        .page-container { max-width: 800px; margin: 20px auto; background-color: #fff; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
                        .content-wrapper { padding: 40px; }
                        .header { background: #FFB6C1; color: #5D4E60; padding: 25px; border-radius: 15px 15px 0 0; text-align: center; }
                        .header h1 { font-size: 2.5rem; margin: 0; font-weight: 700; }
                        .header p { font-size: 1.1rem; margin-top: 5px; }
                        .info-bar { display: flex; justify-content: space-between; margin-bottom: 25px; padding-bottom: 10px; border-bottom: 2px solid #FFE4E1; font-size: 0.9rem; }
                        .card { background: #F8F9FA; padding: 20px; border-radius: 12px; margin-bottom: 25px; page-break-inside: avoid; }
                        .card h2 { color: #D8838F; margin: 0 0 15px 0; border-bottom: 2px solid #FFE4E1; padding-bottom: 8px; font-size: 1.5rem; }
                        .cost-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
                        .cost-total { background: #FFF0F5; padding: 12px; margin-top: 10px; border-radius: 8px; font-weight: bold; font-size: 1.1rem; display: flex; justify-content: space-between; border-left: 5px solid #D8838F; }
                        .results-card { background: linear-gradient(135deg, #E6F7FF, #F0F8FF); padding: 25px; border-radius: 15px; text-align: center; margin-bottom: 25px; page-break-inside: avoid; }
                        .results-card h2 { color: #5D7A8C; margin: 0 0 20px 0; border: none; }
                        .price-box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px; page-break-inside: avoid; }
                        .price-box .label { font-size: 1rem; color: #666; }
                        .price-box .amount { font-size: 2.5rem; font-weight: bold; margin-top: 5px; }
                        .ingredients-table { width: 100%; border-collapse: collapse; }
                        .ingredients-table th, .ingredients-table td { padding: 8px; border-bottom: 1px solid #eee; }
                        .ingredients-table th { background: #F5D5CE; text-align: left; color: #5D4E60; }
                        .footer { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #FFE4E1; font-size: 0.9rem; color: #888; }
                        .downloader-container { text-align: center; padding: 20px; background: #fff5f5; }
                        .downloader-button { padding: 15px 30px; font-size: 1.1rem; font-weight: 700; background-color: #FFD93D; color: #5D4E60; border: none; border-radius: 10px; cursor: pointer; transition: background-color 0.3s; animation: pulse 2.5s infinite; }
                        .downloader-button:hover { background-color: #FFC107; }
                        .downloader-button:disabled { background-color: #ccc; cursor: not-allowed; animation: none; }
                        @media print { .downloader-container { display: none; } .page-container { box-shadow: none; margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="downloader-container">
                        <button class="downloader-button" onclick="descargarPDF()">‚ú® ¬°Descargar PDF Ahora! ‚ú®</button>
                    </div>
                    <div class="page-container" id="cotizacion-a-descargar">
                        <div class="header">
                            <h1>üéÇ Cotizaci√≥n de Reposter√≠a üßÅ</h1>
                            <p>${recipeName}</p>
                        </div>
                        <div class="content-wrapper">
                            <div class="info-bar">
                                <div><strong>Fecha de Emisi√≥n:</strong> ${fecha}</div>
                                <div><strong>V√°lida hasta:</strong> ${validez}</div>
                            </div>
                            <div class="card">
                                <h2>üìã Resumen del Pedido</h2>
                                <p><strong>Tipo de Producto:</strong> <span style="font-size: 1.1rem; font-weight: bold;">${productType}</span></p>
                                <p><strong>Cantidad a Producir:</strong> <span style="font-size: 1.1rem; font-weight: bold;">${totalQuantity} ${unitName}</span></p>
                            </div>
                            <div class="card">
                                <h2>üí∞ Desglose de Costos</h2>
                                <div class="cost-item"><span>ü•Ñ Costo de Ingredientes:</span> <strong>${costos.ingredientes}</strong></div>
                                <div class="cost-item"><span>üë©‚Äçüç≥ Mano de Obra:</span> <strong>${costos.manoObra}</strong></div>
                                <div class="cost-item"><span>üîß Desgaste de Utensilios (2%):</span> <strong>${costos.desgaste}</strong></div>
                                <div class="cost-item"><span>üì¶ Servicios, Empaque y Otros:</span> <strong>${costos.extras}</strong></div>
                                <div class="cost-total">
                                    <span>üíé COSTO TOTAL DE PRODUCCI√ìN:</span>
                                    <span>${costos.total}</span>
                                </div>
                            </div>
                            <div class="results-card">
                                <h2>üéØ Precio de Venta y Ganancia</h2>
                                <p>C√°lculo basado en <strong>${resultados.modo}</strong> con un <strong>${resultados.porcentaje}%</strong> aplicado.</p>
                                <div class="price-box">
                                    <div class="label">PRECIO DE VENTA FINAL</div>
                                    <div class="amount" style="color: #2C5F5F;">${resultados.precioFinal}</div>
                                </div>
                                <div class="price-box">
                                    <div class="label">GANANCIA NETA ESTIMADA</div>
                                    <div class="amount" style="color: #98D8C8;">${resultados.ganancia}</div>
                                </div>
                            </div>
                            <div class="card">
                                <h2>ü•£ Ingredientes Principales</h2>
                                <table class="ingredients-table">
                                    <thead><tr><th>Ingrediente</th><th style="text-align: right;">Costo en Receta</th></tr></thead>
                                    <tbody>
                                        ${ingredientes.map(ing => `<tr><td>${ing.nombre}</td><td style="text-align: right;">${ing.costo}</td></tr>`).join('')}
                                    </tbody>
                                </table>
                            </div>
                            <div class="footer">
                                <p>Gracias por confiar en nosotros para endulzar tus momentos especiales.</p>
                                <p style="margin-top: 5px;"><em>Cotizaci√≥n generada con la Calculadora Profesional de Reposter√≠a.</em></p>
                            </div>
                        </div>
                    </div>
                    <script>
                        function descargarPDF() {
                            const boton = document.querySelector('.downloader-button');
                            boton.textContent = 'Descargando...';
                            boton.disabled = true;
                            const elemento = document.getElementById('cotizacion-a-descargar');
                            const opt = {
                                margin: 0,
                                filename: '${recipeName.replace(/\s+/g, '_')}.pdf',
                                image: { type: 'jpeg', quality: 0.98 },
                                html2canvas: { scale: 2, useCORS: true },
                                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                            };
                            html2pdf().set(opt).from(elemento).save().then(() => {
                                boton.textContent = '‚ú® ¬°Descargar PDF Ahora! ‚ú®';
                                boton.disabled = false;
                            });
                        }
                    <\/script>
                </body>
                </html>
            `;
            
            const nuevaVentana = window.open('', '_blank');
            nuevaVentana.document.open();
            nuevaVentana.document.write(htmlCotizacion);
            nuevaVentana.document.close();
        }

        document.addEventListener('DOMContentLoaded', () => {
            actualizarHistorialDropdown();
            updateCalculations();
        });
    </script>
</body>
</html>

